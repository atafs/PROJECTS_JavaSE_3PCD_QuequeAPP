package com.iscte.queque.client.thread;

import java.io.ObjectInputStream;

import com.iscte.queque.client.gui.ClientFrame;
import com.iscte.queque.server.bean.ChatMessage;

/** THREAD to receive messages from client */
public class In implements Runnable {
	private ObjectInputStream input;

	public In(Socket socket) {
		try {
			this.input = new ObjectInputStream(socket.getInputStream());
		} catch (java.io.IOException ex) {
			logger.getLog().info("IOException="+ex);

		}
	}

	public void run() {
		ChatMessage message = null;
		try {
			while ((message = (ChatMessage) this.input.readObject()) != null) {
				ChatMessage.Action action = message.getAction();

				if (action.equals(ChatMessage.Action.CONNECT)) {
					connect(message);
				} else if (action.equals(ChatMessage.Action.DISCONNECT)) {
					disconnected();
					socket.close();
				} else if (action.equals(ChatMessage.Action.SEND_ONE)) {
					receive(message);
				} else if (action.equals(ChatMessage.Action.USERS_ONLINE)) {
					refreshOnlines(message);
				}
			}
		} catch (java.io.IOException ex) {
			java.util.logging.Logger.getLogger(ClientFrame.class.getName())
					.log(java.util.logging.Level.SEVERE, null, ex);
		} catch (ClassNotFoundException ex) {
			java.util.logging.Logger.getLogger(ClientFrame.class.getName())
					.log(java.util.logging.Level.SEVERE, null, ex);
		}
	}
}
